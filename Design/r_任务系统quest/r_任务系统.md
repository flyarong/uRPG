# 任务系统



## 任务属性

变量名	变量类型	字段名
id	int	任务id（以3打头共8位）
type	byte	任务类型（mission_type）
name	String	任务名称id
des	String	描述
level	int	任务等级
precontype	byte	前置条件类型(0无条件，1等级，2使用道具，3任务)
preconvalue	int	前置条件类型值
duration	int	任务时长（单位：s,没有时间限制就空着）
awards	arr_int	奖励列表
parameter1 int 任务目标参数1
parameter2 int 任务目标参数2

## 任务类型

- 击杀怪物记数，需要获取事件：`击杀怪物`
- 送货或对话，需要获取事件：`与npc交互`
- 护送，需要获取事件：`npc护送完成`

## 任务状态

任务在接受前，不记录在角色身上。这里只说明角色身上的任务状态

- 进行中
- 完成未交付
- 已交付:不再显示在客户端

## 任务上线

玩家能携带的任务数量上限，暂定为20个

## 功能概述

- 所有任务相关功能逻辑
- 不同任务类型，接取提交逻辑都不同
- 任务最多可领取10个（留配置）

## 任务所需配置

- 任务分类： 每个任务均有一个分类
- 任务内容类型： 完成任务的要求，每个任务只有一种任务要求
- 任务领取前置条件： 领取任务的要求，需要支持多个
- 任务过场触发： 任务过程中需要出发的剧情，需要支持多段
- 领取任务时给玩家添加buff：任务领取后给玩家增加某个buff/debuff

## 任务领取流程

- 基本步骤为领取任务——完成任务——交还任务（个别任务类型会有变动）

### 领取任务

- 领取任务时需要判断玩家符合前置条件
- 符合条件则接取成功，不符合任务接取条件的话不会触发任务接取对话

### 完成任务

- 玩家接取任务后，在任务列表中显示任务的完成条件
- 玩家根据任务类型通过通过不同的操作完成任务

### 交还任务

- 玩家完成任务条件后，提交任务获得奖励
- 任务奖励在任务提交之后获得，不提交不会获得奖励

### 放弃任务

- 大部分任务玩家均可放弃，放弃后可重新接取

## 任务表现

- 与任务相关的npc头等会有特效标志
- 大致分为3种：主线和支线的标志不同
l 已完成（主线/支线）：已完成的任务，点击可直接交任务获得奖励
l 可领取（支线）：达到领取条件，点击可直接领取任务
l 进行中（主线/支线）：正在进行的任务，“已完成”标志完成前是“进行中”
任务分类
Ø 任务有多种分类，需要留配置
主线任务
Ø 主线任务是一个巨大的任务链
Ø 主线任务具有唯一性，每个仅可接取一次，完成的任务不会再次接取
Ø 主线任务的顺序固定不可被改变，不可被放弃
Ø 主线任务可能有多条，但每一个玩家只有一条
Ø 每个玩家同时只会有1个主线任务
Ø 主线任务不占任务个数
Ø 玩家账号创建时会自动接取第1个主线任务
任务交接方式

Ø 通过与npc对话的方式进行交接，交任务的同时接取下一个任务
Ø 上一个任务的结束对话与下一个任务的开始对话是连起来的
支线任务
Ø 支线任务为一个单独的任务，彼此之间没有关联
Ø 支线任务可已反复接取
Ø 支线任务可领取多个
任务交接方式

Ø 任务接取方式有两种：对话接取，界面接取
l 与npc对话接取：找到指定npc预期对话，完成任务后，再与指定npc对话结束
l 直接界面接取：打开界面点击按钮接取，完成任务后，再与点击按钮结束
任务放弃相关

Ø 支线任务可被放弃，放弃后支线任务进度清零，再次接取需要从新坐起
Ø 支线任务可随时放弃，不影响再次接取
日常任务
Ø 日常任务逻辑与支线任务相同，为每天固定发放的支线任务
Ø 每天可完成1次（留配置），全部完成后当天不可再次领取
Ø 每天早5点刷新（留配置）
循环任务
Ø 逻辑类似主线任务
Ø 跑环任务也是一个任务链，但任务顺序不固定
Ø 任务交接方式与主线任务相同
跑环任务池

Ø 环任务有个任务池，每次任务从任务池中随机1个连接上
任务放弃相关

Ø 放弃流程同支线任务，但玩家角色中途放弃跑环任务，再次接取时，将从任务线未完成的任务开始
任务重置相关

Ø 任务有接取次数，每完成一环任务，算作一次
Ø 放弃任务直接算作这一次结束
Ø 任务环数不会重置，会一直累计下去，最后一环结束后再从第一环开始
任务奖励相关

Ø 任务奖励为基本奖励*当前环数加成
Ø 奖励内容数量需要方便乘以环数加成
引导任务
Ø 功能引导的任务，达到领取条件后自动领取，玩家点击任务开始播放引导
Ø 类似，添加好友，加入工会之类的
Ø 引导任务不占任务个数
触发引导任务条件

Ø 等级达到指定等级
Ø 第一次进入某些功能
Ø 第一次打开某些界面
引导任务跳过条件

Ø 当由于特殊原因导致引导任务中断时，玩家再次打开该界面不会再次触发引导
罗盘任务
Ø 区域任务不需要主动接取，进入区域范围后自己动接取任务
Ø 符合条件的玩家进入任务区域就能领到任务
Ø 区域任务不占任务个数
Ø 玩家不必组队，只要始终待在区域内，则任务条件达成，就算任务完成
Ø 玩家角色在条件达成前，离开任务区域，会提示“离开目标区域”，则任务失败，区域任务自动移除出任务列表
Ø 玩家角色离开后，再返回，将重新领取任务
Ø 玩家角色离线，再次上线，且仍在任务区域内，若任务没结束则任务继续
Ø 任务区域内玩家角色全部死亡，任务任然继续
Ø 区域任务有时间限制，超过时间任务失败
Ø 区域任务条件达成后，区域范围内的玩家自动获得奖励
交互任务
Ø 交互任务分为两种：抢夺任务、竞争任务、合作任务
Ø 交互任务交接/放弃/奖励逻辑与支线任务基本相同
Ø 同一交互任务最多只能有300（留配置）人同时接取
Ø 超过300人后不可在被接取，每个玩家同时只能接取3个（留配置）交互任务
抢夺任务

Ø 全服任务数量固定，不绑定在玩家身上，绑定在服务器身上
Ø 每完成一个，任务总数少一个，每人同时只能领取一个抢夺任务
Ø 抢夺任务有时间限制（需要留配置）
Ø 时间结束后，已领取的可继续做完，但奖励减少只有一些保底奖励
Ø 抢夺任务放弃时需要消耗道具（留配置）
竞争任务

Ø 多个玩家会接取同一个任务，只有最先完成的可获得奖励
Ø 只有最先完成得人会获得高额奖励，其他完成的人只有保底奖励
Ø 竞争任务增加时间限制，超过时间限制该任务过期删除
合作任务

Ø 多个玩家会接取同一个任务，所有人进行任务均会增加任务进度
Ø 任务进度全服统一
Ø 任务需要有接取人数限制（留配置）
Ø 放弃任务的玩家不可再次接取同一个任
Ø 任务有贡献值，贡献值与玩家绑定，完成内容越多贡献值越多，任务完成后根据贡献值发放奖励
仙府任务
Ø 详见仙府任务文档
多个任务提交方式
Ø Npc身上的事件有4种：可接任务、可完成任务、提交物品、功能入口
Ø 弹出方式规则如下：
l 若npc身上只有1种事件则直接打开对应事件的界面
l 若npc身上有多种事件，有可完成任务的话，点击直接弹出可完成任务的对话，若有多个根据任务id（或其他）一次弹出
l 如npc身上有多种事件且没有可完成任务，点击npc打开一个选择界面，玩家选择需要进行的下一步操作 
任务内容类型
Ø 每个分类的任务都需要支持配置以下类型
杀怪型
Ø 击杀n个指定怪物，只要玩家攻击到指定怪物就算击杀个数
Ø 放弃任务杀怪个数清0
l 例：击杀5只A怪
收集型
Ø 收集指定物品，可通过任意渠道收集
Ø 放弃任务对物品没有影响
l 例：收集5只狼肉
采集型
Ø 采集指定物品，只有接取任务的玩家才可以采集指定物品
Ø 移动到对应物体旁边，点击该物体，做采集动作，界面有个进度条，进度条走完（1s）后采集成功，进度条进行中玩家移动、死亡、被攻击、释放技能则进度条打断（详细已采集文档为准）
l 例：采集5株草药
采集表现

Ø 采集时需要播采集动作
对话型
Ø 找到指定NPC对话即可
l 例：与XXX对话
通关副本型
Ø 胜利通关指定副本后任务自动完成
l 例：通关指定副本
触发怪物型
Ø 领取任务或移动到指定位置后玩家身边会刷出怪物或物品
l 例：前往XXX后击杀怪物
物品提交型
Ø 需要向指定npc提交道具
l 例：上交XXX
提交流程 

Ø 与指定npc对话，手动提交任务物品
Ø 上交物品直接放上，数量足够，提交按钮亮显点击直接交任务
Ø 显示当前拥有数量与总数“XX/XX”XX是需要该物品总数量，数量足够数字绿色，数量不足数字红色
达到指定位置型
Ø 达到某地图或某地图的指定区域后完成任务
l 例：前往XXX位置
npc跟随型
Ø 需要两种：跟随npc，npc跟随
Ø 任务产生的npc所有玩家都能看到
Ø 玩家自己的npc有特效标记
l 例：将npc护送到XXXX
跟随npc

Ø 需要玩家跟随npc移动到指定地点
Ø 中途玩家不能与npc距离过远（留配置）
Ø 距离超多最远距离的2/3弹提示文本“与目标npc距离过远”
Ø 距离超多最远距离任务失败
Ø 跟随npc死亡任务失败
npc跟随

Ø 任务期间会有npc跟随玩家，玩家移动到指定地点，任务完成
Ø 跟随npc死亡任务失败
完成功能型
Ø 需要玩家完成某些功能，详细需求之后再补充
l 例：参加一次仙府战、升级一次气脉、占领一次民居
任务过场触发相关
Ø 在任务的开始或者结束后需要支持添加过场
过场触发流程
Ø 任务推进至需要播放剧情动画的步骤
Ø 角色停止移动，玩家无法操作角色
Ø 如果玩家处于组队状态，有此过场任务的玩家角色播放动画，没有此任务的玩家角色不受影响，但任务要等有任务的玩家动画播放完成才会继续推进（如：任务下一步是BOSS战，则等有任务的玩家动画播放完成后，BOSS才会刷新）
Ø 其他玩家向其发起交易，组队等邀请，会在动画播放完成后，才在被邀请的玩家的UI显示确认界面
Ø 角色头顶显示特殊标志，表示正在正在进行过场
Ø 动画结束，玩家恢复对角色的控制
跳过相关
Ø 过场有跳过功能（可配置是否开启）
Ø 点击跳过直接关闭过场，开始之后的对话或任务
特殊情况处理
Ø 如果玩家角色在播放动画时离线，关闭客户端，重新连线后，任务步骤进行到播放动画后，玩家无法重新观看动画
任务领取前置条件
Ø 任务是否可领取的条件
Ø 只有满足条件与npc对话才能触发任务
Ø 任务个数达到上限不算在领取前置条件中
条件类型
Ø 等级达到指定条件
Ø 战力达到指定条件
Ø 完成指定任务
Ø 持有指定道具（包括宠物/坐骑/装备/时装）
Ø 之后根据需要还会补充
特殊情况
Ø 个别类型的任务前置条件需要特殊处理
主线任务

Ø 主线任务的领取条件只有等级
Ø 当等级未达到下一个任务的领取条件时，自动接取一个“继续修行”任务
l 任务大体内容为“请提升等级到XX级”（XX是下一个任务的领取等级）
l 该任务没有奖励
跑环任务

Ø 跑环任务只有第1个任务有领取条件
Ø 只要能领第1个那之后的就没有条件限制了
领取任务时给玩家添加buff
Ø 领取任务后给玩家增加buff，具体加那个留配置
Ø Buff需要有时间限制
Ø 任务结束后需要删除buff
奖励相关
Ø 每个任务奖励需要支持不同（留配置，可以填空）
Ø 任务奖励在提交任务之后发放
